<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>dividas</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="group/assets/img/favicon.png" rel="icon">
  <link href="group/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="group/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="group/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="group/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="group/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="group/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="group/assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: NiceSchool
  * Template URL: https://bootstrapmade.com/nice-school-bootstrap-education-template/
  * Updated: May 10 2025 with Bootstrap v5.3.6
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="index-page">


  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

<nav>
  <ul>
    <li><a href="group.html">Despesas</a></li>
    <li><a href="pagamentos.html">Pagamentos</a></li>
  </ul>
</nav>


      <!--<nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html" class="active">Home</a></li>
          <li class="dropdown"><a href="about.html"><span>About</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="about.html">About Us</a></li>
              <li><a href="admissions.html">Admissions</a></li>
              <li><a href="academics.html">Academics</a></li>
              <li><a href="faculty-staff.html">Faculty &amp; Staff</a></li>
              <li><a href="campus-facilities.html">Campus &amp; Facilities</a></li>
            </ul>
          </li>

          <li><a href="students-life.html">Students Life</a></li>
          <li><a href="news.html">News</a></li>
          <li><a href="events.html">Events</a></li>
          <li><a href="alumni.html">Alumni</a></li>
          <li class="dropdown"><a href="#"><span>More Pages</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="news-details.html">News Details</a></li>
              <li><a href="event-details.html">Event Details</a></li>
              <li><a href="privacy.html">Privacy</a></li>
              <li><a href="terms-of-service.html">Terms of Service</a></li>
              <li><a href="404.html">Error 404</a></li>
              <li><a href="starter-page.html">Starter Page</a></li>
            </ul>
          </li>

          <li class="dropdown"><a href="#"><span>Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="#">Dropdown 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Dropdown</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                <ul>
                  <li><a href="#">Deep Dropdown 1</a></li>
                  <li><a href="#">Deep Dropdown 2</a></li>
                  <li><a href="#">Deep Dropdown 3</a></li>
                  <li><a href="#">Deep Dropdown 4</a></li>
                  <li><a href="#">Deep Dropdown 5</a></li>
                </ul>
              </li>
              <li><a href="#">Dropdown 2</a></li>
              <li><a href="#">Dropdown 3</a></li>
              <li><a href="#">Dropdown 4</a></li>
            </ul>
          </li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>-->

    </div>
  </header>
  <main class="main">

    <!-- Hero Section -->
    <section id="hero" class="hero section dark-background">

      <div class="hero-container">
        <video autoplay="" muted="" loop="" playsinline="" class="video-background">
          <source src="group/assets/img/education/video-2.mp4" type="video/mp4">
        </video>
        <div class="overlay"></div>
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-7" data-aos="zoom-out" data-aos-delay="100">
              <div class="hero-content">
                <h2 id="group-name">Grupo</h2>
                <h1>Membros do grupo</h1>
                <p>Lista dos criminoso.</p>
                <!--<div class="cta-buttons">
                  <a href="#" class="btn-primary">Start Your Journey</a>
                  <a href="#" class="btn-secondary">Discover Programs</a>
                </div>-->
                  <ul id="members-list"></ul>

  <input type="email" id="new-member-email" placeholder="Email do novo membro" />
  <button id="add-member-btn">Adicionar Membro</button>

  <h3>Despesas</h3>
  <ul id="expenses-list"></ul>

  <h3>Nova Despesa</h3>
  <input type="text" id="expense-title" placeholder="TÃ­tulo da despesa"><br>
  <input type="number" id="expense-amount" placeholder="Valor"><br>

  <label>Quem pagou:</label>
  <select id="paid-by"></select><br>

  <label>Dividir com:</label><br>
  <div id="members-checkboxes"></div>

  <button onclick="addExpense()">Adicionar</button>

  <h3>Saldos dos Membros</h3>
  <ul id="balance-list"></ul>
  
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const auth = firebase.auth();

    const groupId = localStorage.getItem("currentGroupId");
    const groupNameEl = document.getElementById("group-name");
    const expensesList = document.getElementById("expenses-list");
    const paidBySelect = document.getElementById("paid-by");
    const membersList = document.getElementById("members-list");
    const membersCheckboxes = document.getElementById("members-checkboxes");

    
    let groupMembers = [];

    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "index.html";
        return;
      }

      const groupRef = db.collection("groups").doc(groupId);

      // Carregar dados do grupo
      groupRef.get().then(doc => {
        const group = doc.data();
        groupNameEl.textContent = group.name;
        groupMembers = group.members || [];

        // Atualizar UI de membros
        membersList.innerHTML = "";
        paidBySelect.innerHTML = "";
        membersCheckboxes.innerHTML = "";

        groupMembers.forEach(uid => {
          db.collection("users").doc(uid).get().then(userDoc => {
            const userData = userDoc.data();
            const displayName = userData.nickname || userData.email;

            // Lista de membros
            const li = document.createElement("li");
            li.textContent = displayName;
            membersList.appendChild(li);

            // SeleÃ§Ã£o "quem pagou"
            const option = document.createElement("option");
            option.value = uid;
            option.textContent = displayName;
            paidBySelect.appendChild(option);

            // Checkboxes "dividir com"
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = uid;
            checkbox.id = `member-${uid}`;

            const label = document.createElement("label");
            label.htmlFor = checkbox.id;
            label.textContent = displayName;

            membersCheckboxes.appendChild(checkbox);
            membersCheckboxes.appendChild(label);
            membersCheckboxes.appendChild(document.createElement("br"));
          });
        });
      });

// Despesas em tempo real
db.collection("groups").doc(groupId).collection("expenses")
  .orderBy("timestamp", "desc")
  .onSnapshot(snapshot => {
    expensesList.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();

      // Buscar dados do utilizador que pagou
      db.collection("users").doc(data.paidBy).get().then(userDoc => {
        const userData = userDoc.data();
        const displayName = userData.nickname || userData.email;

        const li = document.createElement("li");
        li.textContent = `${data.title} - â‚¬${data.amount} (Pago por ${displayName}, dividido com ${data.splitBetween.length} pessoas)`;

        // ðŸ”— Torna a despesa clicÃ¡vel
        li.style.cursor = "pointer";
        li.addEventListener("click", () => {
          window.location.href = `detalhe.html?id=${doc.id}&groupId=${groupId}`;
        });

        expensesList.appendChild(li);
      });
    });

    // Recalcular saldos
    calcularSaldos();
  });

      // Adicionar despesa
      window.addExpense = () => {
        const title = document.getElementById("expense-title").value;
        const amount = parseFloat(document.getElementById("expense-amount").value);
        const paidBy = paidBySelect.value;
        const splitBetween = Array.from(membersCheckboxes.querySelectorAll("input:checked")).map(cb => cb.value);

        if (!title || !amount || !paidBy || splitBetween.length === 0) {
          alert("Preenche todos os campos");
          return;
        }

        db.collection("groups").doc(groupId).collection("expenses").add({
          title,
          amount,
          paidBy,
          splitBetween,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        document.getElementById("expense-title").value = "";
        document.getElementById("expense-amount").value = "";
      };

      // Adicionar membro por email
      document.getElementById("add-member-btn").addEventListener("click", () => {
        const email = document.getElementById("new-member-email").value.trim();
        if (!email) return alert("Introduz um email vÃ¡lido");

        db.collection("users").where("email", "==", email).get()
          .then(snapshot => {
            if (snapshot.empty) {
              alert("Utilizador nÃ£o encontrado.");
              return;
            }

            const userDoc = snapshot.docs[0];
            const uid = userDoc.id;

            if (groupMembers.includes(uid)) {
              alert("Este utilizador jÃ¡ estÃ¡ no grupo.");
              return;
            }

            return groupRef.update({
              members: firebase.firestore.FieldValue.arrayUnion(uid)
            }).then(() => {
              alert("Membro adicionado com sucesso.");
              window.location.reload(); // recarrega para atualizar UI
            });
          })
          .catch(err => {
            console.error("Erro ao adicionar membro:", err);
            alert("Erro ao adicionar membro.");
          });
      });
    });

    
    function calcularSaldos() {
      const saldos = {};
      groupMembers.forEach(uid => saldos[uid] = 0);

      db.collection("groups").doc(groupId).collection("expenses").get()
        .then(snapshot => {
          snapshot.forEach(doc => {
            const despesa = doc.data();
            const valorPorPessoa = despesa.amount / despesa.splitBetween.length;

            saldos[despesa.paidBy] += despesa.amount;

            despesa.splitBetween.forEach(uid => {
              saldos[uid] -= valorPorPessoa;
            });
          });

          const balanceList = document.getElementById("balance-list");
          balanceList.innerHTML = "";

          for (const [uid, saldo] of Object.entries(saldos)) {
            db.collection("users").doc(uid).get().then(doc => {
              const nome = doc.data().nickname || doc.data().email;
              const li = document.createElement("li");
              li.textContent = `${nome}: ${saldo.toFixed(2)} â‚¬`;
              balanceList.appendChild(li);
            });
          }
        });
    }
  </script>

              </div>
            </div>

            <div class="col-lg-5" data-aos="zoom-out" data-aos-delay="200">
              <div class="stats-card">
                <div class="stats-header">
                  <h3>Why Choose Us</h3>
                  <div class="decoration-line"></div>
                </div>
                <div class="stats-grid">
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="bi bi-trophy-fill"></i>
                    </div>
                    <div class="stat-content">
                      <h4>98%</h4>
                      <p>Graduate Employment</p>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="bi bi-globe"></i>
                    </div>
                    <div class="stat-content">
                      <h4>45+</h4>
                      <p>International Partners</p>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="bi bi-mortarboard"></i>
                    </div>
                    <div class="stat-content">
                      <h4>15:1</h4>
                      <p>Student-Faculty Ratio</p>
                    </div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-icon">
                      <i class="bi bi-building"></i>
                    </div>
                    <div class="stat-content">
                      <h4>120+</h4>
                      <p>Degree Programs</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!--<div class="event-ticker">
        <div class="container">
          <div class="row gy-4">
            <div class="col-md-6 col-xl-4 col-12 ticker-item">
              <span class="date">NOV 15</span>
              <span class="title">Open House Day</span>
              <a href="#" class="btn-register">Register</a>
            </div>
            <div class="col-md-6 col-12 col-xl-4  ticker-item">
              <span class="date">DEC 5</span>
              <span class="title">Application Workshop</span>
              <a href="#" class="btn-register">Register</a>
            </div>
            <div class="col-md-6 col-12 col-xl-4 ticker-item">
              <span class="date">JAN 10</span>
              <span class="title">International Student Orientation</span>
              <a href="#" class="btn-register">Register</a>
            </div>
          </div>
        </div>
      </div>-->

    </section><!-- /Hero Section -->

  </main>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="group/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="group/assets/vendor/php-email-form/validate.js"></script>
  <script src="group/assets/vendor/aos/aos.js"></script>
  <script src="group/assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="group/assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="group/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="group/assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="group/assets/vendor/glightbox/js/glightbox.min.js"></script>

  <!-- Main JS File -->
  <script src="group/assets/js/main.js"></script>

</body>

</html>